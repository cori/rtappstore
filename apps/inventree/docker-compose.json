{
  "services": [
    {
      "name": "inventree-db",
      "image": "postgres:17",
      "environment": [
        {
          "key": "PGDATA",
          "value": "/var/lib/postgresql/data/pgdb"
        },
        {
          "key": "POSTGRES_USER",
          "value": "${INVENTREE_DB_USER}"
        },
        {
          "key": "POSTGRES_PASSWORD",
          "value": "${INVENTREE_DB_PASSWORD}"
        },
        {
          "key": "POSTGRES_DB",
          "value": "${INVENTREE_DB_NAME}"
        },
        {
          "key": "POSTGRES_INITDB_ARGS",
          "value": "--encoding=UTF8"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/postgresql",
          "containerPath": "/var/lib/postgresql/data"
        }
      ],
      "internalPort": "5432"
    },
    {
      "name": "inventree-cache",
      "image": "redis:7-alpine",
      "internalPort": "6379"
    },
    {
      "name": "inventree-server",
      "image": "inventree/inventree:stable",
      "isMain": true,
      "dependsOn": ["inventree-db", "inventree-cache"],
      "environment": [
        {
          "key": "INVENTREE_DB_ENGINE",
          "value": "postgresql"
        },
        {
          "key": "INVENTREE_DB_NAME",
          "value": "${INVENTREE_DB_NAME}"
        },
        {
          "key": "INVENTREE_DB_HOST",
          "value": "inventree-db"
        },
        {
          "key": "INVENTREE_DB_PORT",
          "value": "5432"
        },
        {
          "key": "INVENTREE_DB_USER",
          "value": "${INVENTREE_DB_USER}"
        },
        {
          "key": "INVENTREE_DB_PASSWORD",
          "value": "${INVENTREE_DB_PASSWORD}"
        },
        {
          "key": "INVENTREE_CACHE_ENABLED",
          "value": "True"
        },
        {
          "key": "INVENTREE_CACHE_HOST",
          "value": "inventree-cache"
        },
        {
          "key": "INVENTREE_CACHE_PORT",
          "value": "6379"
        },
        {
          "key": "INVENTREE_PLUGINS_ENABLED",
          "value": "True"
        },
        {
          "key": "INVENTREE_AUTO_UPDATE",
          "value": "True"
        },
        {
          "key": "INVENTREE_LOG_LEVEL",
          "value": "WARNING"
        },
        {
          "key": "INVENTREE_ADMIN_USER",
          "value": "${INVENTREE_ADMIN_USER}"
        },
        {
          "key": "INVENTREE_ADMIN_PASSWORD",
          "value": "${INVENTREE_ADMIN_PASSWORD}"
        },
        {
          "key": "INVENTREE_ADMIN_EMAIL",
          "value": "${INVENTREE_ADMIN_EMAIL}"
        },
        {
          "key": "INVENTREE_SITE_URL",
          "value": "http://${APP_DOMAIN}:${APP_PORT}"
        },
        {
          "key": "INVENTREE_CSRF_TRUSTED_ORIGINS",
          "value": "${INVENTREE_CSRF_TRUSTED_ORIGINS}"
        },
        {
          "key": "INVENTREE_USE_X_FORWARDED_HOST",
          "value": "True"
        },
        {
          "key": "INVENTREE_USE_X_FORWARDED_PORT",
          "value": "True"
        },
        {
          "key": "INVENTREE_USE_X_FORWARDED_PROTO",
          "value": "True"
        },
        {
          "key": "INVENTREE_GUNICORN_TIMEOUT",
          "value": "90"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data",
          "containerPath": "/home/inventree/data"
        }
      ],
      "internalPort": "8000"
    },
    {
      "name": "inventree-worker",
      "image": "inventree/inventree:stable",
      "command": "invoke worker",
      "dependsOn": ["inventree-server"],
      "environment": [
        {
          "key": "INVENTREE_DB_ENGINE",
          "value": "postgresql"
        },
        {
          "key": "INVENTREE_DB_NAME",
          "value": "${INVENTREE_DB_NAME}"
        },
        {
          "key": "INVENTREE_DB_HOST",
          "value": "inventree-db"
        },
        {
          "key": "INVENTREE_DB_PORT",
          "value": "5432"
        },
        {
          "key": "INVENTREE_DB_USER",
          "value": "${INVENTREE_DB_USER}"
        },
        {
          "key": "INVENTREE_DB_PASSWORD",
          "value": "${INVENTREE_DB_PASSWORD}"
        },
        {
          "key": "INVENTREE_CACHE_ENABLED",
          "value": "True"
        },
        {
          "key": "INVENTREE_CACHE_HOST",
          "value": "inventree-cache"
        },
        {
          "key": "INVENTREE_CACHE_PORT",
          "value": "6379"
        },
        {
          "key": "INVENTREE_PLUGINS_ENABLED",
          "value": "True"
        },
        {
          "key": "INVENTREE_AUTO_UPDATE",
          "value": "True"
        },
        {
          "key": "INVENTREE_LOG_LEVEL",
          "value": "WARNING"
        },
        {
          "key": "INVENTREE_SITE_URL",
          "value": "http://${APP_DOMAIN}:${APP_PORT}"
        },
        {
          "key": "INVENTREE_CSRF_TRUSTED_ORIGINS",
          "value": "${INVENTREE_CSRF_TRUSTED_ORIGINS}"
        }
      ],
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data",
          "containerPath": "/home/inventree/data"
        }
      ]
    }
  ]
}
